@model CIM.Web.Models.AssetAttributeValueViewModel
@{
    ViewBag.Title = "Create Attribute Value";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<h5>Edit Attribute Value</h5><p></p>
<hr />
@using (Html.BeginForm())
{
@Html.AntiForgeryToken()
<table class="table table-borderless">
    <thead>
        <tr>
            <th>@Html.LabelFor(model => model.AssetAttributeID, "AssetAttribute", htmlAttributes: new { @class = "control-label" })</th>
            <th>@Html.LabelFor(model => model.Value, htmlAttributes: new { @class = "control-label" })</th>
            <th></th>
        </tr>
    </thead>

    <tbody class="attributeList">
        @if (ViewBag.AssetAttributeValueViewModel != null)
            {
                foreach (var item in ViewBag.AssetAttributeValueViewModel)
                {
        <tr class="attributeRow">
            <td class="">@item.AssetTypeAttribute.Name:</td>
            <td>
                <input type="search" class="form-control" id="ValueAttribute" placeholder="Enter value attribute..." value="@(item.Value)" name="ValueAttribute">
                @Html.ValidationMessageFor(model => model.Value, "", new { @class = "text-danger" })
                @Html.Hidden("idAtttibuteValue", (object)item.ID)
                @Html.Hidden("idAttribute", (object)item.AssetAttributeID)
                @Html.Hidden("idAsset", (object)item.Asset.ID)
            </td>
            @* <td class="text-hide">@item.ID</td> *@
        </tr>
                }
            }
    </tbody>

    <tfoot>
        <tr>
            <td>
                <div class="col-md-offset-2 col-md-10">
                    <input id="btnSubmit" type="button" value="Save" class="btn btn-primary active" />
                    <a href="@Url.Action("Index")" class="btn btn-link">Cancel</a>
                </div>
            </td>
            <td></td>
            <td></td>
        </tr>
    </tfoot>
</table>
}
@section scripts{
    <script>
        function getAllData() {
            var data = [];
            $('tbody tr').each(function () {
                var Value = $(this).find('#ValueAttribute').val();
                var ID = $(this).find('#idAtttibuteValue').val();
                var IdAttribute = $(this).find('#idAttribute').val();
                var idAsset = $(this).find('#idAsset').val();
                var alldata = {
                    'Value': Value,
                    'AssetAttributeID': IdAttribute,
                    'AssetID': idAsset,
                    'ID': ID,
                    'Active':true,
                            }
            data.push(alldata);
            });
            console.log(data);
            return data;
        }
        $('#btnSubmit').click(function () {
            var valueAttribute = JSON.stringify(getAllData());
            var assetEdit = '@ViewBag.Asset';
//            console.log(data1);
            $.ajax({
                url: '/Asset/EditAttributeValue',
                type: 'POST',
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify({ 'jsonAssetAttribute': valueAttribute,'asset':assetEdit }),
                success: function (valueAttribute,assetEdit) {
                    console.log(valueAttribute);
                    window.location.href = '@Url.Action("Index", "Asset")';
                },
                error: function () {
                    alert("Error while inserting data");
                    window.location.href = '@Url.Action("Create", "Asset")';
                }
            });
        });
    </script>
}